<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¿ã‚¹ã‚¯åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <link rel="stylesheet" href="css/analysis-styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="header">
        <div class="container">
            <h1>ğŸ“Š ã‚¿ã‚¹ã‚¯åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
            <p>æ—¥å ±ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸæ¥­å‹™åˆ†æãƒ¬ãƒãƒ¼ãƒˆ</p>
        </div>
    </header>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="main-content">
        <div class="container">
            <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
            <div id="loading" class="loading">
                <div class="loading-spinner"></div>
                <p>æ—¥å ±ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>
            </div>

            <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
            <div id="error" class="error-message hidden">
                ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
            </div>

            <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æœ¬ä½“ -->
            <div id="dashboard" class="hidden">
                <!-- çµ±è¨ˆã‚µãƒãƒªãƒ¼ -->
                <section class="summary-grid" id="summary"></section>

                <!-- ã‚°ãƒ©ãƒ•ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <section class="charts-grid">
                    <!-- æ¥­å‹™æ™‚é–“ã®æ¨ç§» -->
                    <div class="chart-card full-width">
                        <h2>æ¥­å‹™æ™‚é–“ã®æ¨ç§»</h2>
                        <div class="chart-container">
                            <canvas id="hoursChart"></canvas>
                        </div>
                    </div>

                    <!-- æ¥­å‹™ç¨®åˆ¥ã®æ™‚é–“é…åˆ† -->
                    <div class="chart-card">
                        <h2>æ¥­å‹™ç¨®åˆ¥ã®æ™‚é–“é…åˆ†</h2>
                        <div class="chart-container">
                            <canvas id="categoryPieChart"></canvas>
                        </div>
                    </div>

                    <!-- ç·åˆè©•ä¾¡ã®æ¨ç§» -->
                    <div class="chart-card">
                        <h2>ç·åˆè©•ä¾¡ã®æ¨ç§»</h2>
                        <div class="chart-container">
                            <canvas id="ratingChart"></canvas>
                        </div>
                    </div>

                    <!-- æ—¥åˆ¥ã‚¿ã‚¹ã‚¯æ•°ã¨å®Œäº†çŠ¶æ³ -->
                    <div class="chart-card full-width">
                        <h2>æ—¥åˆ¥ã‚¿ã‚¹ã‚¯æ•°ã¨å®Œäº†çŠ¶æ³</h2>
                        <div class="chart-container">
                            <canvas id="taskCompletionChart"></canvas>
                        </div>
                    </div>
                </section>

                <!-- æˆæœãƒ»é”æˆäº‹é … -->
                <section class="list-section">
                    <h2>âœ… ä¸»è¦ãªæˆæœãƒ»é”æˆäº‹é …</h2>
                    <div class="list-items" id="achievementsList"></div>
                </section>

                <!-- èª²é¡Œãƒ»å•é¡Œç‚¹ -->
                <section class="list-section">
                    <h2>âš ï¸ èª²é¡Œãƒ»å•é¡Œç‚¹</h2>
                    <div class="list-items" id="issuesList"></div>
                </section>

                <!-- ã‚¿ã‚¹ã‚¯è©³ç´°ãƒ†ãƒ¼ãƒ–ãƒ« -->
                <section class="list-section">
                    <h2>ğŸ“‹ å…¨ã‚¿ã‚¹ã‚¯ä¸€è¦§</h2>
                    <div class="table-container">
                        <table id="tasksTable">
                            <thead>
                                <tr>
                                    <th>æ—¥ä»˜</th>
                                    <th>æ¥­å‹™å†…å®¹</th>
                                    <th>ã‚«ãƒ†ã‚´ãƒª</th>
                                    <th>æ‰€è¦æ™‚é–“</th>
                                    <th>é€²æ—çŠ¶æ³</th>
                                </tr>
                            </thead>
                            <tbody id="tasksTableBody"></tbody>
                        </table>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 ã‚¿ã‚¹ã‚¯åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | æ—¥å ±ãƒ‡ãƒ¼ã‚¿è‡ªå‹•è§£æã‚·ã‚¹ãƒ†ãƒ </p>
        </div>
    </footer>

    <!-- JavaScriptãƒ•ã‚¡ã‚¤ãƒ« -->
    <script src="js/analyzer.js"></script>
    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let charts = {};
        let analyzer;
        let data;

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                // ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ã‚’åˆæœŸåŒ–
                analyzer = new DailyReportAnalyzer();
                
                // ãƒ‡ãƒ¼ã‚¿ã‚’è§£æ
                data = await analyzer.analyzeAll();
                
                // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’è¡¨ç¤º
                renderDashboard(data);
                
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’éè¡¨ç¤ºã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’è¡¨ç¤º
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                
            } catch (error) {
                console.error('ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('error').classList.remove('hidden');
            }
        });

        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’æç”»
        function renderDashboard(data) {
            renderSummary(data.analytics);
            renderCharts(data.analytics);
            renderAchievements(data.analytics.allAchievements);
            renderIssues(data.analytics.allIssues);
            renderTasksTable(data.analytics.allTasks);
        }

        // çµ±è¨ˆã‚µãƒãƒªãƒ¼ã‚’æç”»
        function renderSummary(analytics) {
            const summaryHtml = `
                <div class="summary-card info">
                    <div class="summary-card-label">åˆ†ææœŸé–“</div>
                    <div class="summary-card-value">${analytics.totalDays}<span class="summary-card-unit">æ—¥é–“</span></div>
                </div>
                <div class="summary-card success">
                    <div class="summary-card-label">ç·æ¥­å‹™æ™‚é–“</div>
                    <div class="summary-card-value">${analytics.totalHours.toFixed(1)}<span class="summary-card-unit">æ™‚é–“</span></div>
                </div>
                <div class="summary-card warning">
                    <div class="summary-card-label">å¹³å‡æ¥­å‹™æ™‚é–“</div>
                    <div class="summary-card-value">${analytics.averageHours.toFixed(1)}<span class="summary-card-unit">æ™‚é–“/æ—¥</span></div>
                </div>
                <div class="summary-card info">
                    <div class="summary-card-label">å¹³å‡è©•ä¾¡</div>
                    <div class="summary-card-value">${analytics.averageRating.toFixed(1)}<span class="summary-card-unit">/ 5.0</span></div>
                </div>
            `;
            document.getElementById('summary').innerHTML = summaryHtml;
        }

        // ã‚°ãƒ©ãƒ•ã‚’æç”»
        function renderCharts(analytics) {
            // æ¥­å‹™æ™‚é–“ã®æ¨ç§»ã‚°ãƒ©ãƒ•
            renderHoursChart(analytics.dailyData);
            
            // æ¥­å‹™ç¨®åˆ¥ã®æ™‚é–“é…åˆ†ã‚°ãƒ©ãƒ•
            renderCategoryPieChart(analytics.hoursByCategory);
            
            // ç·åˆè©•ä¾¡ã®æ¨ç§»ã‚°ãƒ©ãƒ•
            renderRatingChart(analytics.dailyData);
            
            // ã‚¿ã‚¹ã‚¯å®Œäº†çŠ¶æ³ã‚°ãƒ©ãƒ•
            renderTaskCompletionChart(analytics.dailyData);
        }

        // æ¥­å‹™æ™‚é–“ã®æ¨ç§»ã‚°ãƒ©ãƒ•
        function renderHoursChart(dailyData) {
            const ctx = document.getElementById('hoursChart').getContext('2d');
            
            if (charts.hoursChart) {
                charts.hoursChart.destroy();
            }
            
            charts.hoursChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dailyData.map(d => d.date),
                    datasets: [{
                        label: 'æ¥­å‹™æ™‚é–“',
                        data: dailyData.map(d => d.hours),
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'æ™‚é–“'
                            }
                        }
                    }
                }
            });
        }

        // æ¥­å‹™ç¨®åˆ¥ã®æ™‚é–“é…åˆ†ã‚°ãƒ©ãƒ•
        function renderCategoryPieChart(hoursByCategory) {
            const ctx = document.getElementById('categoryPieChart').getContext('2d');
            
            if (charts.categoryPieChart) {
                charts.categoryPieChart.destroy();
            }
            
            const categories = Object.keys(hoursByCategory);
            const hours = Object.values(hoursByCategory);
            
            const colors = [
                '#2563eb', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899'
            ];
            
            charts.categoryPieChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categories,
                    datasets: [{
                        data: hours,
                        backgroundColor: colors.slice(0, categories.length),
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: ${value.toFixed(1)}æ™‚é–“ (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // ç·åˆè©•ä¾¡ã®æ¨ç§»ã‚°ãƒ©ãƒ•
        function renderRatingChart(dailyData) {
            const ctx = document.getElementById('ratingChart').getContext('2d');
            
            if (charts.ratingChart) {
                charts.ratingChart.destroy();
            }
            
            charts.ratingChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dailyData.map(d => d.date),
                    datasets: [{
                        label: 'ç·åˆè©•ä¾¡',
                        data: dailyData.map(d => d.rating),
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 5,
                            ticks: {
                                stepSize: 1
                            },
                            title: {
                                display: true,
                                text: 'è©•ä¾¡ (â­)'
                            }
                        }
                    }
                }
            });
        }

        // ã‚¿ã‚¹ã‚¯å®Œäº†çŠ¶æ³ã‚°ãƒ©ãƒ•
        function renderTaskCompletionChart(dailyData) {
            const ctx = document.getElementById('taskCompletionChart').getContext('2d');
            
            if (charts.taskCompletionChart) {
                charts.taskCompletionChart.destroy();
            }
            
            charts.taskCompletionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dailyData.map(d => d.date),
                    datasets: [
                        {
                            label: 'å®Œäº†ã‚¿ã‚¹ã‚¯',
                            data: dailyData.map(d => d.completedTasks),
                            backgroundColor: '#10b981',
                            borderRadius: 4
                        },
                        {
                            label: 'æœªå®Œäº†ã‚¿ã‚¹ã‚¯',
                            data: dailyData.map(d => d.taskCount - d.completedTasks),
                            backgroundColor: '#f59e0b',
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            stacked: true
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            },
                            title: {
                                display: true,
                                text: 'ã‚¿ã‚¹ã‚¯æ•°'
                            }
                        }
                    }
                }
            });
        }

        // æˆæœãƒ»é”æˆäº‹é …ã‚’æç”»
        function renderAchievements(achievements) {
            const html = achievements.slice(0, 10).map(item => `
                <div class="list-item achievement-item">
                    <div class="list-item-date">${item.date}</div>
                    <div class="list-item-content">${item.achievement}</div>
                </div>
            `).join('');
            
            document.getElementById('achievementsList').innerHTML = html || '<p class="text-muted">æˆæœãƒ»é”æˆäº‹é …ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        }

        // èª²é¡Œãƒ»å•é¡Œç‚¹ã‚’æç”»
        function renderIssues(issues) {
            const html = issues.slice(0, 10).map(item => `
                <div class="list-item issue-item">
                    <div class="list-item-date">${item.date}</div>
                    <div class="list-item-content">${item.issue}</div>
                </div>
            `).join('');
            
            document.getElementById('issuesList').innerHTML = html || '<p class="text-muted">èª²é¡Œãƒ»å•é¡Œç‚¹ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        }

        // ã‚¿ã‚¹ã‚¯ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æç”»
        function renderTasksTable(tasks) {
            const html = tasks.map(task => {
                const progressBadge = task.progress === 'å®Œäº†' 
                    ? '<span class="badge badge-success">å®Œäº†</span>'
                    : task.progress.includes('%')
                    ? '<span class="badge badge-warning">' + task.progress + '</span>'
                    : '<span class="badge badge-info">' + task.progress + '</span>';
                
                return `
                    <tr>
                        <td>${task.date}</td>
                        <td>${task.name}</td>
                        <td><span class="badge badge-info">${task.category}</span></td>
                        <td>${task.hours.toFixed(1)}æ™‚é–“</td>
                        <td>${progressBadge}</td>
                    </tr>
                `;
            }).join('');
            
            document.getElementById('tasksTableBody').innerHTML = html;
        }
    </script>
</body>
</html>



